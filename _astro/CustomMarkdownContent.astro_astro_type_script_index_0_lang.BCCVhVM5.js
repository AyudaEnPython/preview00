const u="rb-styles",p=["script[type='text/runnable']","pre.runnable","div.runnable","runnable"].join(","),d={run:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path fill="currentColor"
        d="M5.0333 14.8284L6.44751 16.2426L10.6902 12L6.44751 7.75733L5.0333 9.17155L7.86172 12L5.0333 14.8284Z"
      />
      <path d="M15 14H11V16H15V14Z" fill="currentColor" />
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M2 2C0.895431 2 0 2.89543 0 4V20C0 21.1046 0.89543 22 2 22H22C23.1046 22 24 21.1046 24 20V4C24 2.89543 23.1046 2 22 2H2ZM22 4H2L2 20H22V4Z"
      />
    </svg>`,clear:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" >
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M3.49997 12.8995C2.71892 13.6805 2.71892 14.9468 3.49997 15.7279L7.35785 19.5858H4.08576C3.53347 19.5858 3.08576 20.0335 3.08576 20.5858C3.08576 21.1381 3.53347 21.5858 4.08576 21.5858H20.0858C20.638 21.5858 21.0858 21.1381 21.0858 20.5858C21.0858 20.0335 20.638 19.5858 20.0858 19.5858H10.9558L20.4705 10.071C21.2516 9.28999 21.2516 8.02366 20.4705 7.24261L16.2279 2.99997C15.4468 2.21892 14.1805 2.21892 13.3995 2.99997L3.49997 12.8995ZM7.82579 11.4021L4.91418 14.3137L9.15683 18.5563L12.0684 15.6447L7.82579 11.4021ZM9.24 9.98787L13.4826 14.2305L19.0563 8.65683L14.8137 4.41418L9.24 9.98787Z"
      />
    </svg>`,copy:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path d="M13 7H7V5H13V7Z" fill="currentColor" />
      <path d="M13 11H7V9H13V11Z" fill="currentColor" />
      <path d="M7 15H13V13H7V15Z" fill="currentColor" />
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M3 19V1H17V5H21V23H7V19H3ZM15 17V3H5V17H15ZM17 7V19H9V21H19V7H17Z"
      />
    </svg>`,on:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path fill="currentColor"
        d="M7 15C5.34315 15 4 13.6569 4 12C4 10.3431 5.34315 9 7 9C8.65685 9 10 10.3431 10 12C10 13.6569 8.65685 15 7 15Z"
      />
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M24 12C24 8.13401 20.866 5 17 5H7C3.13401 5 0 8.13401 0 12C0 15.866 3.13401 19 7 19H17C20.866 19 24 15.866 24 12ZM17 7H7C4.23858 7 2 9.23858 2 12C2 14.7614 4.23858 17 7 17H17C19.7614 17 22 14.7614 22 12C22 9.23858 19.7614 7 17 7Z"
      />
    </svg>`,off:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path fill="currentColor"
        d="M17 15C18.6569 15 20 13.6569 20 12C20 10.3431 18.6569 9 17 9C15.3431 9 14 10.3431 14 12C14 13.6569 15.3431 15 17 15Z"
      />
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M0 12C0 8.13401 3.13401 5 7 5H17C20.866 5 24 8.13401 24 12C24 15.866 20.866 19 17 19H7C3.13401 19 0 15.866 0 12ZM7 7H17C19.7614 7 22 9.23858 22 12C22 14.7614 19.7614 17 17 17H7C4.23858 17 2 14.7614 2 12C2 9.23858 4.23858 7 7 7Z"
      />
    </svg>`,vim:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <path fill-rule="evenodd" clip-rule="evenodd" fill="currentColor"
        d="M21.2635 2.29289C20.873 1.90237 20.2398 1.90237 19.8493 2.29289L18.9769 3.16525C17.8618 2.63254 16.4857 2.82801 15.5621 3.75165L4.95549 14.3582L10.6123 20.0151L21.2189 9.4085C22.1426 8.48486 22.338 7.1088 21.8053 5.99367L22.6777 5.12132C23.0682 4.7308 23.0682 4.09763 22.6777 3.70711L21.2635 2.29289ZM16.9955 10.8035L10.6123 17.1867L7.78392 14.3582L14.1671 7.9751L16.9955 10.8035ZM18.8138 8.98525L19.8047 7.99429C20.1953 7.60376 20.1953 6.9706 19.8047 6.58007L18.3905 5.16586C18 4.77534 17.3668 4.77534 16.9763 5.16586L15.9853 6.15683L18.8138 8.98525Z"
      />
      <path fill="currentColor"
        d="M2 22.9502L4.12171 15.1717L9.77817 20.8289L2 22.9502Z"
      />
    </svg>`,check:`
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
    >
      <path fill="currentColor"
        d="M10.5858 13.4142L7.75735 10.5858L6.34314 12L10.5858 16.2427L17.6568 9.1716L16.2426 7.75739L10.5858 13.4142Z"
      />
    </svg>`},h=new Blob([`
importScripts("https://cdn.jsdelivr.net/pyodide/v0.28.0/full/pyodide.js");

async function init() {
  self.pyodide = await loadPyodide();
  await self.pyodide.loadPackage("micropip");
  self.pyprint = s => {
    self.postMessage({ results: String(s), partial: true });
  };
  await self.pyodide.runPythonAsync(\`
import sys, js
class JSWriter:
    def write(self, s): js.globalThis.pyprint(s)
    def flush(self): pass
sys.stdout = JSWriter()
\`);
  self.inputResolvers = {};
  self.nextInputId = 0;
  self.js_request_input = prompt => {
    const id = self.nextInputId++;
    return new Promise(resolve => {
      self.inputResolvers[id] = resolve;
      self.postMessage({ type: "input_request", id, prompt });
    });
  };
  await self.pyodide.registerJsModule("input_bridge", {
    request_input: self.js_request_input
  });
  await self.pyodide.runPythonAsync(\`
import builtins, sys
from input_bridge import request_input
async def input(prompt=""):
    value = await request_input(prompt)
    if prompt:
        print(f"{prompt}{value}")
        sys.stdout.flush()
    return value
builtins.input = input
\`);
}
const ready = init();
self.onmessage = async ({ data }) => {
  await ready;
  if (data.type === "input_response") {
    const resolver = self.inputResolvers[data.id];
    if (resolver) {
      resolver(data.value ?? "");
      delete self.inputResolvers[data.id];
    }
    return;
  }
  if (data.pythonCode) {
    try {
      let code = data.pythonCode;
      const hasInput = /\\binput\\s*\\(/.test(code);
      if (hasInput) {
        code = code.replace(/\\binput\\s*\\(/g, "await input(");
        code = code.replace(
          /^def\\s+main\\s*\\(/m,
          "async def main("
        );
        code = code.replace(
          /if\\s+__name__\\s*==\\s*['"]__main__['"]\\s*:\\s*\\n\\s*main\\(\\)/m,
          "await main()"
        );
      }
      await self.pyodide.loadPackagesFromImports(code);
      await self.pyodide.runPythonAsync(code);
      self.postMessage({ done: true });
    } catch (err) {
      self.postMessage({ error: err.message });
    }
  }
};
`],{type:"application/javascript"}),m=new Blob([`
      self.onmessage = (event) => {
        const { jsCode } = event.data;
        try {
          let output = '';
          const originalConsoleLog = console.log;
          console.log = (...args) => {
            output += args.join(' ') + '\\n';
            originalConsoleLog.apply(console, args);
          };
          eval(jsCode);
          console.log = originalConsoleLog;
          self.postMessage({ partial: true, results: output });
          self.postMessage({ done: true });
        } catch (error) {
          self.postMessage({ error: error.message });
        }
      };
    `],{type:"application/javascript"});function c(e,t,o=!1){return e.hasAttribute(t)?e.getAttribute(t)!=="false":e.parentElement?.hasAttribute(t)?e.parentElement.getAttribute(t)!=="false":o}function f(){if(document.getElementById(u))return;const e=document.createElement("style");e.id=u,e.textContent=`
    .rb-container {
      position: relative; background-color: transparent;
      border-radius: calc(0.5rem + 1px);
      line-height: 1.45; padding: 0px; margin: 24px 0px;
      box-shadow: 2px 2px 8px 4px #00000040;
    }
    .rb-editor { border-radius: calc(0.5rem + 1px); padding: 2px; }
    .rb-btn {
      background: transparent; border: 1px solid #808080; border-radius: 4px;
      height: 26px; width: 26px; padding: 1px 0;
      display: flex; align-items: center; justify-content: center;
    }
    .rb-btn-group {
      position: absolute; z-index: 10; top: 8px; right: 8px; display: flex; gap: 4px;
    }
    .rb-btn svg { width: 1.5em; height: 1em; transition: opacity 0.2s }
    .rb-btn:hover { color: #d4d4d4; border-color: #d4d4d4; }
    .rb-output { margin: 0; padding: 0; color: #808080; white-space: pre-wrap; }
    .rb-output:not(:empty) {
      font-family: monospace; font-size: 0.875rem;
      margin: 4px 8px; padding-bottom: 4px;
    }
    .rb-loading { display: flex; justify-content: center; align-items: center; }
    .rb-loading div {
      width: 0.3rem; height: 0.3rem; margin: 0.4rem 0.3rem; border-radius: 50%;
      background: #808080; animation: 0.9s bounce infinite alternate;
    }
    .rb-loading div:nth-child(2) { animation-delay: 0.3s; }
    .rb-loading div:nth-child(3) { animation-delay: 0.6s; }
    @keyframes bounce {
      to { opacity: 0.3; transform: translate3d(0, -0.4rem, 0); }
    }
  `,document.head.appendChild(e)}function g(e,t,o,i,r){const n=document.createElement("div");n.classList.add("rb-editor");const s=ace.edit(n);return s.session.setMode(`ace/mode/${i}`),s.setOptions({readOnly:!r,fontSize:"0.875rem",fontFamily:"Source Code Pro Variable",highlightActiveLine:!1,highlightGutterLine:!1,showFoldWidgets:!1,showGutter:o,showPrintMargin:!1,minLines:1,maxLines:40,useSoftTabs:!0,tabSize:4}),r||(s.renderer.$cursorLayer.element.style.display="none"),s.container.style.lineHeight="1.45",s.renderer.setScrollMargin(10,10),s.renderer.setPadding(10),s.setValue(t),e.appendChild(n),s}function y(e,t){const o=document.createElement("div");o.className="rb-btn-group",Object.entries(t).forEach(([i,r])=>{const n=document.createElement("button");n.className="rb-btn",n.dataset.name=i,n.innerHTML=d[i],n.addEventListener("click",r),o.appendChild(n)}),e.appendChild(o)}function v(e){const t=document.createElement("div");return t.className="rb-output",e.appendChild(t),t}function b(e){e.textContent="";const t=document.createElement("div");return t.className="rb-loading",t.innerHTML="<div></div><div></div><div></div>",e.appendChild(t),t}class l{static instances=[];constructor(t,o,i,r,n=!1,s=!1){f(),this.container=t,this.codeType=r,this.editable=n,this.vimEnabled=!1,this.worker=new Worker(URL.createObjectURL(r==="python"?h:m)),this.container.classList.add("rb-container","not-content"),this.editor=g(t,o,i,r,n),this.output=v(this.container),this.actions={run:()=>this.runCode(),clear:()=>this.clearOutput(),copy:()=>this.copyCode()},this.editable&&(this.actions.vim=()=>this.toggleVim()),s||y(t,this.actions),l.instances.push(this)}runCode(){this.loader=b(this.output),this.worker.onmessage=({data:o})=>{if(o.type==="input_request"){const i=window.prompt(o.prompt||"");this.worker.postMessage({type:"input_response",id:o.id,value:i});return}if(o.error){this.output.textContent=this._handleError(o.error),this.loader.remove();return}if(o.partial){this.output.appendChild(document.createTextNode(o.results));return}if(o.done){this.loader.remove();return}};const t=this.editor.getValue();this.codeType==="python"?this.worker.postMessage({pythonCode:t}):this.worker.postMessage({jsCode:t})}clearOutput(){this.output.textContent=""}copyCode(){const t=this.container.querySelector('.rb-btn[data-name="copy"]'),o=t.innerHTML;navigator.clipboard.writeText(this.editor.getValue()).then(()=>{t.innerHTML=d.check,setTimeout(()=>{t.innerHTML=o},1e3)}).catch(()=>{t.style.borderColor="red",setTimeout(()=>{t.style.borderColor=""},1e3)})}toggleVim(){this.vimEnabled=!this.vimEnabled,this.editor.setKeyboardHandler(this.vimEnabled?"ace/keyboard/vim":null),this.updateVimButton()}updateVimButton(){const t=this.container.querySelector('.rb-btn[data-name="vim"]');t&&(t.innerHTML=this.vimEnabled?d.on:d.off,t.style.opacity=this.vimEnabled?"1":"0.6")}applyTheme(t){const r=t==="dark"?{ace:"dark",btn:"#808080",hover:"#FFD43B"}:{ace:"light_default",btn:"#808080",hover:"#364bff"};this.editor.setTheme(`ace/theme/github_${r.ace}`),this.container.querySelectorAll(".rb-btn").forEach(n=>{n.style.color=r.btn,n.style.borderColor=r.btn,n.onmouseenter=()=>{n.style.color=r.hover,n.style.borderColor=r.hover},n.onmouseleave=()=>{n.style.color=r.btn,n.style.borderColor=r.btn}})}_handleError(t){const i=(t.message||t.toString()).split(`
`);return i[i.length-2]||"Error!"}}function a(){const e=document.documentElement.getAttribute("data-theme")||(document.documentElement.classList.contains("dark")||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");l.instances.forEach(t=>t.applyTheme(e))}function C(){document.querySelectorAll(p).forEach(e=>{const t=e.textContent.trim(),o=c(e,"data-lines"),i=c(e,"data-edit"),r=c(e,"data-hide-buttons"),n=e.dataset.code||"python",s=document.createElement("div");e.replaceWith(s),new l(s,t,o,n,i,r).editor.clearSelection(!0)}),a()}function L(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",a),new MutationObserver(a).observe(document.documentElement,{attributes:!0,attributeFilter:["class","data-theme"]}),window.addEventListener("storage",e=>{e.key==="theme"&&a()}),document.addEventListener("astro:theme-change",a)}function w(){document.addEventListener("keydown",e=>{const t=(e.ctrlKey||e.metaKey)&&e.altKey&&e.code==="Enter",o=(e.ctrlKey||e.metaKey)&&e.altKey&&(e.code==="Backslash"||e.code==="IntlBackslash"||e.key==="\\"),i=(e.ctrlKey||e.metaKey)&&e.altKey&&(e.code==="Quote"||e.key==="'");if(!t&&!o&&!i)return;e.preventDefault(),e.stopImmediatePropagation();const r=document.activeElement,n=l.instances.find(s=>s.container.contains(r));n&&(t&&n.editable&&n.toggleVim(),o&&n.runCode(),i&&n.clearOutput())},{capture:!0,passive:!1})}document.addEventListener("DOMContentLoaded",()=>{C(),L(),w()});
